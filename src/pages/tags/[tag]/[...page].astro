---
import BaseLayout from "@layouts/BaseLayout.astro";
import PostCard from "@components/PostCard.astro";
import { Frontmatter, sortDateDescending, getAllUniqueTags, capitalizeString } from "../../../misc";
import { MarkdownInstance, Page } from "astro";
import config from "src/config.js";

export interface Props {
  page: Page<MarkdownInstance<Frontmatter>>;
}

export async function getStaticPaths({ paginate }) {
  const allPosts = await Astro.glob<Frontmatter>('../../blog/posts/*.md');
  const allTags = getAllUniqueTags(allPosts);
  // For every tag, return a paginate() result.
  // Make sure that you pass `{params: {tag}}` to `paginate()`
  // so that Astro knows which tag grouping the result is for.
  return allTags.map((tag) => {
    const filteredPosts = sortDateDescending(allPosts.filter((post) => {
      return post.frontmatter.tags.find(ele => ele === tag) && post.frontmatter.draft != true
    }));

    return paginate(filteredPosts, {
      params: { tag },
      pageSize: config.pageSize ?? 5
    });
  });
}

const { page } = Astro.props;

const { tag } = Astro.params;


---

<BaseLayout title="test">
  <h1 class="text-center text-3xl font-semibold bg-gradient-orange text-transparent bg-clip-text mb-8">
    {capitalizeString(tag.toString()) + " TO-DO: Change color"}</h1>

  <div class="flex flex-wrap flex-col justify-center gap-12">
    {page.data.map(post =>
    <PostCard content={post} />)}
  </div>
</BaseLayout>